<!DOCTYPE html>
<html>
  <head>
    <title>Cache Test</title>
  </head>
  <body>
    <h1>Cache Test</h1>
    <button onclick="testCache()">Test Cache</button>
    <div id="results"></div>

    <script>
      // Test cache functionality
      async function testCache() {
        const results = document.getElementById("results");
        results.innerHTML = "<p>Testing cache...</p>";

        try {
          // Clear any existing cache
          localStorage.clear();

          const query = "red shirt";
          const model = "clip";

          // First request
          console.log("First request...");
          const start1 = Date.now();
          const response1 = await fetch("http://localhost:8000/search-products", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ query, model, top_k: 3 }),
          });
          const data1 = await response1.json();
          const time1 = Date.now() - start1;

          console.log("First response:", data1);
          console.log("First request time:", time1, "ms");

          // Wait 1 second
          await new Promise((resolve) => setTimeout(resolve, 1000));

          // Second request
          console.log("Second request...");
          const start2 = Date.now();
          const response2 = await fetch("http://localhost:8000/search-products", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ query, model, top_k: 3 }),
          });
          const data2 = await response2.json();
          const time2 = Date.now() - start2;

          console.log("Second response:", data2);
          console.log("Second request time:", time2, "ms");

          // Check localStorage
          const cacheKeys = Object.keys(localStorage);
          console.log("Cache keys:", cacheKeys);

          results.innerHTML = `
                    <h2>Results:</h2>
                    <p>First request: ${time1}ms</p>
                    <p>Second request: ${time2}ms</p>
                    <p>Improvement: ${(((time1 - time2) / time1) * 100).toFixed(1)}%</p>
                    <p>Cache entries: ${cacheKeys.length}</p>
                    <p>Results: ${data1.products?.length || 0} products</p>
                `;
        } catch (error) {
          console.error("Error:", error);
          results.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
        }
      }
    </script>
  </body>
</html>
